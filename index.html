<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Baroud Vault 4.0 ğŸ›¡ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #00e676; 
            --danger: #ff1744;
            --dark: #000000;
            --glass: rgba(30, 30, 30, 0.9);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            background-color: var(--dark);
            background-image: radial-gradient(circle at top left, #1a2a1f, #000);
            color: #fff;
            font-family: 'Cairo', sans-serif;
            margin: 0; padding: 20px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Iron Gate) --- */
        #master-login {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-logo {
            font-size: 4rem; color: var(--primary); margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(0, 230, 118, 0.5);
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± --- */
        .header {
            width: 100%; display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; padding: 0 10px;
        }
        .app-title { font-size: 1.5rem; font-weight: 900; letter-spacing: 1px; }
        .app-title span { color: var(--primary); }
        
        .back-btn {
            background: rgba(255,255,255,0.1); border: 1px solid var(--border);
            color: #fff; padding: 10px 15px; border-radius: 12px; cursor: pointer;
            display: none; backdrop-filter: blur(10px);
        }

        /* --- Ø§Ù„ÙƒØ±ÙˆØª --- */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border); border-radius: 20px;
            padding: 20px; margin-bottom: 15px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        /* --- Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ --- */
        #projects-view { width: 100%; max-width: 500px; }
        .project-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px; cursor: pointer; position: relative; overflow: hidden;
            transition: transform 0.2s;
        }
        .project-item:active { transform: scale(0.98); background: rgba(255,255,255,0.05); }
        .p-icon { 
            background: rgba(0, 230, 118, 0.15); color: var(--primary);
            width: 50px; height: 50px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
            margin-left: 15px;
        }
        
        /* --- Ø§Ù„ØªÙØ§ØµÙŠÙ„ --- */
        #details-view { width: 100%; max-width: 500px; display: none; }
        
        .summary-card {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: #000; text-align: center; border: none;
        }
        .summary-val { font-size: 2.5rem; font-weight: 900; margin: 5px 0; }

        .client-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .c-avatar {
            width: 45px; height: 45px; background: #333; color: #fff;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; margin-left: 15px; font-size: 0.9rem;
            border: 2px solid var(--primary);
        }
        .c-info h4 { margin: 0; font-size: 1rem; }
        .c-info p { margin: 2px 0 0; font-size: 0.75rem; color: #aaa; }
        .c-desc { 
            font-size: 0.7rem; color: var(--primary); 
            background: rgba(0,230,118,0.1); padding: 2px 6px; 
            border-radius: 4px; display: inline-block; margin-top: 2px;
        }
        
        .btn-mini {
            width: 35px; height: 35px; border-radius: 10px; border: none;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .btn-wa { background: rgba(37, 211, 102, 0.2); color: #25D366; }
        .btn-del { background: rgba(255, 23, 68, 0.2); color: var(--danger); }

        /* --- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¹Ø§Ù… --- */
        .fab {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: var(--primary); color: #000;
            width: 65px; height: 65px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; box-shadow: 0 0 20px rgba(0, 230, 118, 0.4);
            border: none; cursor: pointer; z-index: 99;
        }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        .modal-box {
            background: #1e1e1e; border: 1px solid var(--border);
            width: 85%; max-width: 320px; padding: 25px; border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes popUp {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        input {
            width: 100%; padding: 15px; margin: 8px 0;
            background: #111; border: 1px solid #333; color: #fff;
            border-radius: 12px; text-align: center; font-size: 1rem;
            font-family: 'Cairo'; outline: none; box-sizing: border-box;
        }
        input:focus { border-color: var(--primary); }

        .btn-full {
            width: 100%; padding: 15px; background: var(--primary);
            color: #000; font-weight: bold; border: none; border-radius: 12px;
            font-size: 1rem; margin-top: 10px; cursor: pointer;
        }
        .btn-cancel {
            background: transparent; color: #888; border: none;
            margin-top: 10px; cursor: pointer; font-weight: bold; font-size: 0.9rem;
        }
        .btn-delete { background: var(--danger); color: #fff; box-shadow: 0 5px 15px rgba(255, 23, 68, 0.3); }
        
        .bulk-send-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5253);
            color: #fff; width: 100%; padding: 15px; border: none;
            border-radius: 15px; font-weight: bold; margin-bottom: 20px;
            display: flex; justify-content: center; align-items: center; gap: 10px;
            box-shadow: 0 5px 15px rgba(238, 82, 83, 0.3); cursor: pointer;
        }

    </style>
</head>
<body>

    <div id="master-login">
        <div class="login-logo"><i class="fa-solid fa-shield-halved"></i></div>
        <h2 style="margin-bottom: 5px">Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ â›”</h2>
        <p style="color:#888; margin-bottom: 20px">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø®Ø§ØµØ© Ø¨Ù€ Houssein Baroud</p>
        
        <div style="width: 300px; padding: 20px; background: #111; border-radius: 20px; border: 1px solid #333;">
            <input type="password" id="master-pass" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" style="font-size: 1.2rem; margin-bottom: 10px;">
            <button class="btn-full" onclick="checkMasterKey()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div class="header">
        <div class="app-title">BAROUD <span>VAULT</span></div>
        <button class="back-btn" onclick="goHome()"><i class="fa-solid fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="projects-view"></div>
    <div id="details-view">
        <div class="glass-card summary-card">
            <div style="font-size:0.9rem; font-weight:bold; opacity:0.8">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</div>
            <div class="summary-val" id="total-debt">$0</div>
        </div>
        <button class="bulk-send-btn" onclick="startBulk()">
            <i class="fa-brands fa-whatsapp"></i> ØªØ­ØµÙŠÙ„ Ø§Ù„ÙƒÙ„ (Ø¥Ø±Ø³Ø§Ù„ Ø³Ø±ÙŠØ¹)
        </button>
        <div class="glass-card" style="padding: 0;" id="clients-list"></div>
    </div>
    <button class="fab" onclick="openAddModal()"><i class="fa-solid fa-plus"></i></button>

    <div id="pin-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>ğŸ”’ Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ù…ÙŠØ©</h3>
            <p style="color:#888;">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</p>
            <input type="password" id="pin-input" placeholder="****" maxlength="8" style="font-size: 1.5rem; letter-spacing: 5px;">
            <button class="btn-full" onclick="verifyPin()">ÙØªØ­</button>
            <button class="btn-cancel" onclick="closePinModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="add-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="modal-title" style="margin-top:0">Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
            <div id="project-inputs">
                <input type="text" id="new-p-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">
                <input type="number" id="new-p-pin" placeholder="ØªØ¹ÙŠÙŠÙ† Ø±Ù…Ø² Ø³Ø±ÙŠ">
            </div>
            <div id="client-inputs" style="display:none">
                <input type="text" id="new-c-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
                <input type="tel" id="new-c-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                <input type="number" id="new-c-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº ($)">
                <input type="text" id="new-c-desc" placeholder="Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            </div>
            <button class="btn-full" onclick="saveData()">Ø­ÙØ¸</button>
            <button class="btn-cancel" onclick="closeAddModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="delete-modal" class="modal-overlay">
        <div class="modal-box">
            <div style="color: var(--danger); font-size: 3rem; margin-bottom: 10px;"><i class="fa-solid fa-trash-can"></i></div>
            <h3 style="margin:0">Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†ØŸ</h3>
            <p style="color:#888; font-size:0.9rem;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹.</p>
            <button class="btn-full btn-delete" onclick="confirmDelete()">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
            <button class="btn-cancel" onclick="closeDeleteModal()">ØªØ±Ø§Ø¬Ø¹</button>
        </div>
    </div>

    <div id="bulk-modal" class="modal-overlay">
        <div class="modal-box" style="background: #fff; color:#000;">
            <div style="font-size:3rem; margin-bottom:10px">ğŸ“¨</div>
            <h3 style="margin:0" id="bulk-c-name">Ø§Ù„Ø§Ø³Ù…</h3>
            <h1 style="margin:5px 0; color: #d32f2f; font-size: 2.5rem" id="bulk-c-amount">$0</h1>
            <p id="bulk-c-desc" style="background:#eee; padding:5px 10px; border-radius:5px; display:inline-block; font-weight:bold;">...</p>
            <p id="bulk-counter" style="color:#666; margin-top:5px;">Ø§Ù„Ø²Ø¨ÙˆÙ† 1 Ù…Ù† 5</p>
            <button class="btn-full" style="background:#25D366; color:#fff" onclick="sendNextBulk()">
                <i class="fa-brands fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨
            </button>
            <button class="btn-cancel" style="color:#555" onclick="closeBulkModal()">Ø¥ÙŠÙ‚Ø§Ù</button>
        </div>
    </div>

    <div id="msg-modal" class="modal-overlay">
        <div class="modal-box">
            <div id="msg-icon" style="font-size:3.5rem; margin-bottom:10px"></div>
            <h3 id="msg-title" style="margin:0">Ø¹Ù†ÙˆØ§Ù†</h3>
            <p id="msg-text" style="color:#aaa; font-size:0.9rem; margin: 10px 0 20px 0;">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</p>
            <button class="btn-full" onclick="closeMsgModal()">Ø­Ø³Ù†Ø§Ù‹</button>
        </div>
    </div>

<script>
    // âš ï¸âš ï¸âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (ØºÙŠØ±Ù‡Ø§ Ù…Ù† Ù‡Ù†Ø§) âš ï¸âš ï¸âš ï¸
    const MASTER_KEY = "Baroud5577"; 
    // âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ---
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©
    if (sessionStorage.getItem('baroud_logged_in') === 'true') {
        document.getElementById('master-login').style.display = 'none';
    }

    function checkMasterKey() {
        const input = document.getElementById('master-pass').value;
        if(input === MASTER_KEY) {
            // ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØµØ­ÙŠØ­Ø©
            document.getElementById('master-login').style.display = 'none';
            // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¬Ù„Ø³Ø© (Ø¹Ø´Ø§Ù† Ø§Ø°Ø§ Ø¹Ù…Ù„ Ø±ÙŠÙØ±Ø´ Ù…Ø§ ÙŠØ·Ù„Ø¨Ù‡Ø§ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©)
            sessionStorage.setItem('baroud_logged_in', 'true');
        } else {
            alert("âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
        }
    }

    // --- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚) ---
    let db = JSON.parse(localStorage.getItem('baroud_secure_v2')) || [];
    let activeProjectIdx = -1;
    let pendingProjectIdx = -1;
    let pendingDeleteIdx = -1;

    renderProjects();

    function showMsg(title, text, type) {
        const icon = document.getElementById('msg-icon');
        const titleEl = document.getElementById('msg-title');
        const textEl = document.getElementById('msg-text');
        titleEl.innerText = title; textEl.innerText = text;
        if(type === 'success') { icon.innerHTML = 'âœ…'; icon.style.color = 'var(--primary)'; } 
        else { icon.innerHTML = 'âš ï¸'; icon.style.color = '#ffcc00'; }
        document.getElementById('msg-modal').style.display = 'flex';
    }
    function closeMsgModal() { document.getElementById('msg-modal').style.display = 'none'; }

    function renderProjects() {
        const container = document.getElementById('projects-view');
        container.innerHTML = '';
        if(db.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#555; margin-top:50px">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ (+)</p>';
            return;
        }
        db.forEach((proj, idx) => {
            const total = proj.clients.reduce((acc, curr) => acc + curr.amount, 0);
            container.innerHTML += `
                <div class="glass-card project-item" onclick="requestAccess(${idx})">
                    <div style="display:flex; align-items:center">
                        <div class="p-icon"><i class="fa-solid fa-briefcase"></i></div>
                        <div class="p-details" style="margin-left:15px">
                            <h3>${proj.name}</h3>
                            <span>${proj.clients.length} Ø²Ø¨Ø§Ø¦Ù† â€¢ Ù…Ø¬Ù…ÙˆØ¹: $${total}</span>
                        </div>
                    </div>
                    <div class="lock-icon"><i class="fa-solid fa-lock"></i></div>
                </div>`;
        });
    }

    function renderClients() {
        const list = document.getElementById('clients-list');
        const totalEl = document.getElementById('total-debt');
        list.innerHTML = '';
        const clients = db[activeProjectIdx].clients;
        const total = clients.reduce((acc, curr) => acc + curr.amount, 0);
        totalEl.innerText = '$' + total;
        if(clients.length === 0) {
            list.innerHTML = '<div style="padding:20px; text-align:center; color:#666">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ† Ù…Ø³Ø¬Ù„Ø©</div>';
            return;
        }
        clients.forEach((c, idx) => {
            const initials = c.name.substring(0,2).toUpperCase();
            const descHtml = c.desc ? `<span class="c-desc">${c.desc}</span>` : '';
            list.innerHTML += `
                <div class="client-item">
                    <div style="display:flex; align-items:center">
                        <div class="c-avatar">${initials}</div>
                        <div class="c-info" style="margin-left:15px">
                            <h4>${c.name}</h4>
                            <p>${c.phone}</p>
                            ${descHtml}
                        </div>
                    </div>
                    <div style="display:flex; align-items:center">
                        <span style="font-weight:bold; margin-left:10px">$${c.amount}</span>
                        <div class="c-actions">
                            <button class="btn-mini btn-wa" onclick="sendSingle(${idx})"><i class="fa-brands fa-whatsapp"></i></button>
                            <button class="btn-mini btn-del" onclick="requestDelete(${idx})"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                </div>`;
        });
    }

    function requestAccess(idx) {
        pendingProjectIdx = idx;
        document.getElementById('pin-modal').style.display = 'flex';
        document.getElementById('pin-input').value = '';
        document.getElementById('pin-input').focus();
    }
    function verifyPin() {
        const input = document.getElementById('pin-input').value;
        if(input === db[pendingProjectIdx].pin) {
            activeProjectIdx = pendingProjectIdx; closePinModal(); openProjectView();
        } else { showMsg("Ø±Ù…Ø² Ø®Ø§Ø·Ø¦", "Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­!", "error"); }
    }
    function saveData() {
        if(activeProjectIdx === -1) {
            const name = document.getElementById('new-p-name').value;
            const pin = document.getElementById('new-p-pin').value;
            if(name && pin) {
                db.push({ name: name, pin: pin, clients: [] });
                updateStorage(); renderProjects(); closeAddModal();
            } else { showMsg("Ù†Ù‚Øµ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ", "error"); }
        } else {
            const name = document.getElementById('new-c-name').value;
            const phone = document.getElementById('new-c-phone').value;
            const amount = document.getElementById('new-c-amount').value;
            const desc = document.getElementById('new-c-desc').value || ""; 
            if(name && phone && amount) {
                db[activeProjectIdx].clients.push({ name, phone, amount: parseFloat(amount), desc });
                updateStorage(); renderClients(); closeAddModal();
            } else { showMsg("Ù†Ù‚Øµ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©", "error"); }
        }
    }
    function confirmDelete() {
        if(pendingDeleteIdx > -1) {
            db[activeProjectIdx].clients.splice(pendingDeleteIdx, 1);
            updateStorage(); renderClients(); closeDeleteModal();
        }
    }
    let bulkQ = []; let bulkIdx = 0;
    function startBulk() {
        bulkQ = db[activeProjectIdx].clients;
        if(bulkQ.length === 0) return showMsg("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ø¨Ø§Ø¦Ù†", "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ† Ù…Ø³Ø¬Ù„Ø©.", "error");
        bulkIdx = 0; document.getElementById('bulk-modal').style.display = 'flex'; updateBulkUI();
    }
    function updateBulkUI() {
        if(bulkIdx >= bulkQ.length) { closeBulkModal(); return showMsg("ØªÙ… Ø¨Ù†Ø¬Ø§Ø­", "ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹!", "success"); }
        const c = bulkQ[bulkIdx];
        document.getElementById('bulk-c-name').innerText = c.name;
        document.getElementById('bulk-c-amount').innerText = '$' + c.amount;
        document.getElementById('bulk-c-desc').innerText = c.desc || "Ø¨Ø¯ÙˆÙ† ÙˆØµÙ";
        document.getElementById('bulk-counter').innerText = `Ø§Ù„Ø²Ø¨ÙˆÙ† ${bulkIdx + 1} Ù…Ù† ${bulkQ.length}`;
    }
    function sendNextBulk() {
        const c = bulkQ[bulkIdx]; const proj = db[activeProjectIdx].name;
        window.open(getWaLink(c, proj), '_blank'); bulkIdx++; updateBulkUI(); 
    }

    function closePinModal() { document.getElementById('pin-modal').style.display = 'none'; pendingProjectIdx = -1; }
    function openProjectView() {
        document.getElementById('projects-view').style.display = 'none'; document.getElementById('details-view').style.display = 'block';
        document.querySelector('.back-btn').style.display = 'block'; document.querySelector('.app-title').innerHTML = db[activeProjectIdx].name;
        renderClients();
    }
    function goHome() {
        activeProjectIdx = -1; document.getElementById('projects-view').style.display = 'block';
        document.getElementById('details-view').style.display = 'none'; document.querySelector('.back-btn').style.display = 'none';
        document.querySelector('.app-title').innerHTML = 'BAROUD <span>VAULT</span>'; renderProjects();
    }
    function openAddModal() {
        const modal = document.getElementById('add-modal'); const pInputs = document.getElementById('project-inputs');
        const cInputs = document.getElementById('client-inputs'); const title = document.getElementById('modal-title');
        document.querySelectorAll('input').forEach(i => i.value = '');
        if(activeProjectIdx === -1) { title.innerText = "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ğŸ”"; pInputs.style.display = 'block'; cInputs.style.display = 'none'; } 
        else { title.innerText = "Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯ ğŸ’¸"; pInputs.style.display = 'none'; cInputs.style.display = 'block'; }
        modal.style.display = 'flex';
    }
    function closeAddModal() { document.getElementById('add-modal').style.display = 'none'; }
    function requestDelete(cIdx) { pendingDeleteIdx = cIdx; document.getElementById('delete-modal').style.display = 'flex'; }
    function closeDeleteModal() { document.getElementById('delete-modal').style.display = 'none'; pendingDeleteIdx = -1; }
    function closeBulkModal() { document.getElementById('bulk-modal').style.display = 'none'; }
    function updateStorage() { localStorage.setItem('baroud_secure_v2', JSON.stringify(db)); }
    function getWaLink(client, projName) {
        let ph = client.phone.toString().replace(/\s/g, ''); if(!ph.startsWith('961')) ph = '961' + ph;
        const descText = client.desc ? `\nØ§Ù„Ø¨ÙŠØ§Ù†: ${client.desc}` : '';
        const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${client.name}ØŒ\nØ­Ø³Ø§Ø¨Ùƒ Ø¨Ù€ *${projName}* Ù‡Ùˆ: $${client.amount}.${descText}\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ³Ø¯ÙŠØ¯ ÙˆØ´ÙƒØ±Ø§Ù‹.`;
        return `https://wa.me/${ph}?text=${encodeURIComponent(msg)}`;
    }
    function sendSingle(cIdx) { const client = db[activeProjectIdx].clients[cIdx]; const proj = db[activeProjectIdx].name; window.open(getWaLink(client, proj), '_blank'); }

</script>
</body>
</html>
