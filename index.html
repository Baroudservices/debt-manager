<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Baroud Manager Pro ğŸš€</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --main-color: #00d26a; --bg-color: #121212; --card-bg: #1e1e1e; }
        body {
            background-color: var(--bg-color); color: #fff;
            font-family: 'Tajawal', sans-serif; margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ØªÙ†Ù‚Ù„ --- */
        .header { width: 100%; text-align: center; margin-bottom: 20px; position: relative; }
        .back-btn {
            position: absolute; right: 0; top: 0;
            background: #333; color: #fff; border: none;
            padding: 8px 15px; border-radius: 8px; cursor: pointer;
            display: none; /* Ù…Ø®ÙÙŠ Ø¨Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        }

        /* --- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ --- */
        #projects-view { width: 100%; max-width: 500px; }
        .project-card {
            background: linear-gradient(135deg, #1e1e1e, #2a2a2a);
            padding: 20px; margin-bottom: 15px; border-radius: 15px;
            border: 1px solid #333; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            transition: 0.2s;
        }
        .project-card:active { transform: scale(0.98); }
        .p-name { font-size: 1.2em; font-weight: bold; }
        .p-total { color: var(--main-color); font-weight: 900; font-size: 1.1em; }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„: Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† --- */
        #details-view { width: 100%; max-width: 500px; display: none; }
        .action-bar {
            display: flex; gap: 10px; margin-bottom: 15px;
        }
        .bulk-btn {
            background: #ff9900; color: #000; font-weight: bold;
            border: none; padding: 12px; border-radius: 10px; flex: 1; cursor: pointer;
        }
        
        .client-card {
            background: var(--card-bg); padding: 15px;
            border-radius: 12px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
            border-right: 4px solid var(--main-color);
        }
        .c-info h4 { margin: 0; font-size: 1.1em; }
        .c-info p { margin: 3px 0 0; color: #888; font-size: 0.8em; }
        .c-amount { color: #ff4d4d; font-weight: bold; }
        .icon-btn {
            background: transparent; border: 1px solid #444; color: #fff;
            padding: 8px; border-radius: 8px; margin-left: 5px; cursor: pointer;
        }

        /* --- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø¥Ø¶Ø§ÙØ© / Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…Ø§Ø¹ÙŠ) --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: none; align-items: center; justify-content: center; flex-direction: column;
        }
        .modal-content {
            background: #222; padding: 25px; border-radius: 20px;
            width: 80%; max-width: 350px; text-align: center; border: 1px solid #444;
        }
        input {
            width: 100%; padding: 12px; margin: 8px 0;
            background: #333; border: 1px solid #555; color: #fff;
            border-radius: 8px; text-align: center; box-sizing: border-box;
        }
        .save-btn {
            width: 100%; padding: 12px; background: var(--main-color);
            border: none; border-radius: 8px; font-weight: bold; margin-top: 10px; cursor: pointer;
        }

        /* Ø³ØªØ§ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ */
        .sender-box {
            background: #fff; color: #000; padding: 20px; border-radius: 20px;
            width: 85%; text-align: center;
        }
        .sender-counter { font-size: 0.9em; color: #555; margin-bottom: 10px; }
        .sender-name { font-size: 1.5em; font-weight: 900; margin-bottom: 5px; }
        .sender-amount { font-size: 2em; color: #d32f2f; font-weight: bold; }
        .next-btn {
            background: #25D366; color: #fff; width: 100%; padding: 15px;
            border: none; border-radius: 10px; font-size: 1.2em; font-weight: bold;
            margin-top: 15px; cursor: pointer;
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ø¦Ù… */
        .fab {
            position: fixed; bottom: 20px; right: 20px;
            background: var(--main-color); width: 60px; height: 60px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 30px; color: #fff; box-shadow: 0 5px 15px rgba(0,210,106,0.4);
            cursor: pointer; border: none;
        }
    </style>
</head>
<body>

    <div class="header">
        <button class="back-btn" onclick="goHome()">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
        <h2 id="page-title">Ù…Ø´Ø§Ø±ÙŠØ¹ Baroud ğŸ’¼</h2>
    </div>

    <div id="projects-view">
        </div>

    <div id="details-view">
        <div class="action-bar">
            <button class="bulk-btn" onclick="startBulkSender()">ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ± Ù„Ù„ÙƒÙ„</button>
        </div>
        <div id="clients-list"></div>
    </div>

    <button class="fab" onclick="openAddModal()">+</button>

    <div id="add-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="in-name" placeholder="Ø§Ù„Ø§Ø³Ù… (Ù…Ø«Ù„Ø§Ù‹: Hunting Store)">
            <input type="number" id="in-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" style="display:none">
            <input type="number" id="in-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº ($)" style="display:none">
            <button class="save-btn" onclick="saveItem()">Ø­ÙØ¸</button>
            <button class="save-btn" style="background:#555; margin-top:5px" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="bulk-modal" class="modal">
        <div class="sender-box">
            <div class="sender-counter" id="bulk-counter">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</div>
            <div class="sender-name" id="bulk-name">Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</div>
            <div class="sender-amount" id="bulk-amount">$0</div>
            <button class="next-btn" onclick="sendNext()">Ø§Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ ğŸš€</button>
            <button style="background:transparent; border:none; color:#555; margin-top:10px" onclick="closeBulk()">Ø¥ÙŠÙ‚Ø§Ù</button>
        </div>
    </div>

<script>
    // Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ø¯Ø§ØªØ§: Ù…ØµÙÙˆÙØ© Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ ÙƒÙ„ Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù‚Ù„Ø¨Ù‡ Ù…ØµÙÙˆÙØ© Ø²Ø¨Ø§Ø¦Ù†
    let data = JSON.parse(localStorage.getItem('baroud_pro_v2')) || [
        { name: "Baroud App", clients: [] },
        { name: "Hunting Store", clients: [] },
        { name: "Tombola", clients: [] }
    ];

    let currentProjectIndex = -1; // -1 ÙŠØ¹Ù†ÙŠ Ù†Ø­Ù†Ø§ Ø¨Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    
    // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ (View Logic) ---

    function renderProjects() {
        const container = document.getElementById('projects-view');
        container.innerHTML = '';
        
        data.forEach((proj, index) => {
            // Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
            let total = proj.clients.reduce((sum, c) => sum + c.amount, 0);
            
            container.innerHTML += `
                <div class="project-card" onclick="openProject(${index})">
                    <div class="p-name">${proj.name}</div>
                    <div class="p-total">$${total}</div>
                </div>
            `;
        });
    }

    function renderClients() {
        const list = document.getElementById('clients-list');
        list.innerHTML = '';
        
        if(currentProjectIndex === -1) return;

        let clients = data[currentProjectIndex].clients;

        if(clients.length === 0) {
            list.innerHTML = '<p style="text-align:center; color:#555">Ù…Ø§ ÙÙŠ Ø¯ÙŠÙˆÙ† Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>';
            return;
        }

        clients.forEach((c, index) => {
            list.innerHTML += `
                <div class="client-card">
                    <div class="c-info">
                        <h4>${c.name}</h4>
                        <p>${c.phone}</p>
                    </div>
                    <div style="display:flex; align-items:center">
                        <div class="c-amount">$${c.amount}</div>
                        <button class="icon-btn" onclick="sendOne(${index})">ğŸ’¬</button>
                        <button class="icon-btn" style="color:#ff4d4d" onclick="deleteClient(${index})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `;
        });
    }

    // --- Ø§Ù„ØªÙ†Ù‚Ù„ ---

    function openProject(index) {
        currentProjectIndex = index;
        document.getElementById('projects-view').style.display = 'none';
        document.getElementById('details-view').style.display = 'block';
        document.querySelector('.back-btn').style.display = 'block';
        document.getElementById('page-title').innerText = data[index].name;
        renderClients();
    }

    function goHome() {
        currentProjectIndex = -1;
        document.getElementById('projects-view').style.display = 'block';
        document.getElementById('details-view').style.display = 'none';
        document.querySelector('.back-btn').style.display = 'none';
        document.getElementById('page-title').innerText = "Ù…Ø´Ø§Ø±ÙŠØ¹ Baroud ğŸ’¼";
        renderProjects();
    }

    // --- Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„Ø­ÙØ¸ ---

    function openAddModal() {
        const modal = document.getElementById('add-modal');
        const title = document.getElementById('modal-title');
        const inName = document.getElementById('in-name');
        const inPhone = document.getElementById('in-phone');
        const inAmount = document.getElementById('in-amount');

        if(currentProjectIndex === -1) {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹
            title.innerText = "Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯";
            inName.placeholder = "Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ù…Ø«Ù„Ø§Ù‹: Ù…Ø·Ø¹Ù…)";
            inPhone.style.display = 'none';
            inAmount.style.display = 'none';
        } else {
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø¨ÙˆÙ†
            title.innerText = "ØªØ³Ø¬ÙŠÙ„ Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯";
            inName.placeholder = "Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†";
            inPhone.style.display = 'block';
            inAmount.style.display = 'block';
        }
        
        inName.value = ''; inPhone.value = ''; inAmount.value = '';
        modal.style.display = 'flex';
    }

    function saveItem() {
        const name = document.getElementById('in-name').value;
        
        if(currentProjectIndex === -1) {
            // Ø­ÙØ¸ Ù…Ø´Ø±ÙˆØ¹
            if(name) {
                data.push({ name: name, clients: [] });
                saveData();
                renderProjects();
                closeModal();
            }
        } else {
            // Ø­ÙØ¸ Ø²Ø¨ÙˆÙ†
            const phone = document.getElementById('in-phone').value;
            const amount = document.getElementById('in-amount').value;
            if(name && phone && amount) {
                data[currentProjectIndex].clients.push({
                    name: name,
                    phone: phone,
                    amount: parseFloat(amount)
                });
                saveData();
                renderClients();
                closeModal();
            }
        }
    }

    function deleteClient(idx) {
        if(confirm("Ø­Ø°Ù Ù‡ÙŠØ¯Ø§ Ø§Ù„Ø¯ÙŠÙ†ØŸ")) {
            data[currentProjectIndex].clients.splice(idx, 1);
            saveData();
            renderClients();
        }
    }

    function closeModal() {
        document.getElementById('add-modal').style.display = 'none';
    }

    function saveData() {
        localStorage.setItem('baroud_pro_v2', JSON.stringify(data));
    }

    // --- Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ±Ø¯ÙŠ ÙˆØ§Ù„Ø¬Ù…Ø§Ø¹ÙŠ) ---

    function getWAMsg(client, project) {
        let phone = client.phone.toString();
        if(!phone.startsWith('961')) phone = '961' + phone;
        
        const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${client.name}ØŒ\nØ­Ø³Ø§Ø¨Ùƒ Ø¨Ù€ *${project}* Ù‡Ùˆ: $${client.amount}.\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ³Ø¯ÙŠØ¯ ÙˆØ´ÙƒØ±Ø§Ù‹!`;
        return `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
    }

    function sendOne(idx) {
        const client = data[currentProjectIndex].clients[idx];
        const projName = data[currentProjectIndex].name;
        window.open(getWAMsg(client, projName), '_blank');
    }

    // ğŸ”¥ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ (Queue System) ğŸ”¥
    let bulkQueue = [];
    let bulkIndex = 0;

    function startBulkSender() {
        if(currentProjectIndex === -1) return;
        
        // Ø¬ÙŠØ¨ ÙƒÙ„ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† Ø¨Ù‡ÙŠØ¯Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        bulkQueue = data[currentProjectIndex].clients;
        
        if(bulkQueue.length === 0) {
            alert("Ù…Ø§ ÙÙŠ Ø­Ø¯Ø§ ØªØ¨Ø¹ØªÙ„Ù‡!");
            return;
        }

        bulkIndex = 0;
        document.getElementById('bulk-modal').style.display = 'flex';
        updateBulkUI();
    }

    function updateBulkUI() {
        if(bulkIndex >= bulkQueue.length) {
            closeBulk();
            alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ù„Ù„Ø¬Ù…ÙŠØ¹!");
            return;
        }

        const client = bulkQueue[bulkIndex];
        document.getElementById('bulk-counter').innerText = `Ø§Ù„Ø²Ø¨ÙˆÙ† ${bulkIndex + 1} Ù…Ù† ${bulkQueue.length}`;
        document.getElementById('bulk-name').innerText = client.name;
        document.getElementById('bulk-amount').innerText = '$' + client.amount;
    }

    function sendNext() {
        const client = bulkQueue[bulkIndex];
        const projName = data[currentProjectIndex].name;
        
        // ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨
        window.open(getWAMsg(client, projName), '_blank');
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØ§Ù„ÙŠ
        bulkIndex++;
        updateBulkUI();
    }

    function closeBulk() {
        document.getElementById('bulk-modal').style.display = 'none';
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    renderProjects();

</script>

</body>
</html>
