<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Baroud Vault ğŸ”’</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #00e676; /* Ù†ÙŠÙˆÙ† Ø£Ø®Ø¶Ø± */
            --danger: #ff1744;
            --dark: #000000;
            --glass: rgba(30, 30, 30, 0.85);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            background-color: var(--dark);
            background-image: radial-gradient(circle at top left, #1a2a1f, #000);
            color: #fff;
            font-family: 'Cairo', sans-serif;
            margin: 0; padding: 20px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„ÙØ®Ù… --- */
        .header {
            width: 100%; display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; padding: 0 10px;
        }
        .app-title { font-size: 1.5rem; font-weight: 900; letter-spacing: 1px; }
        .app-title span { color: var(--primary); }
        
        .back-btn {
            background: rgba(255,255,255,0.1); border: 1px solid var(--border);
            color: #fff; padding: 10px 15px; border-radius: 12px; cursor: pointer;
            display: none; backdrop-filter: blur(10px);
        }

        /* --- Ø§Ù„ÙƒØ±ÙˆØª ÙˆØ§Ù„Ø²Ø¬Ø§Ø¬ --- */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: transform 0.2s;
        }
        
        /* --- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ --- */
        #projects-view { width: 100%; max-width: 500px; }
        .project-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px; cursor: pointer; position: relative; overflow: hidden;
        }
        .project-item:active { transform: scale(0.98); background: rgba(255,255,255,0.05); }
        .p-icon { 
            background: rgba(0, 230, 118, 0.15); color: var(--primary);
            width: 50px; height: 50px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
            margin-left: 15px;
        }
        .p-details h3 { margin: 0; font-size: 1.1rem; }
        .p-details span { font-size: 0.8rem; color: #888; }
        .lock-icon { color: #555; font-size: 0.9rem; }

        /* --- Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ --- */
        #details-view { width: 100%; max-width: 500px; display: none; }
        
        .summary-card {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: #000; text-align: center; border: none;
        }
        .summary-val { font-size: 2.5rem; font-weight: 900; margin: 5px 0; }
        .summary-label { font-size: 0.9rem; opacity: 0.8; font-weight: bold; }

        .client-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .client-item:last-child { border-bottom: none; }
        
        .c-avatar {
            width: 45px; height: 45px; background: #333; color: #fff;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; margin-left: 15px; font-size: 0.9rem;
            border: 2px solid var(--primary);
        }
        .c-info h4 { margin: 0; font-size: 1rem; }
        .c-info p { margin: 2px 0 0; font-size: 0.75rem; color: #aaa; }
        
        .c-actions { display: flex; gap: 8px; }
        .btn-mini {
            width: 35px; height: 35px; border-radius: 10px; border: none;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .btn-wa { background: rgba(37, 211, 102, 0.2); color: #25D366; }
        .btn-del { background: rgba(255, 23, 68, 0.2); color: var(--danger); }

        /* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ù…ÙˆØ¯Ø§Ù„ --- */
        .fab {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: var(--primary); color: #000;
            width: 65px; height: 65px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; box-shadow: 0 0 20px rgba(0, 230, 118, 0.4);
            border: none; cursor: pointer; z-index: 99;
        }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        .modal-box {
            background: #1e1e1e; border: 1px solid var(--border);
            width: 85%; max-width: 320px; padding: 25px; border-radius: 25px;
            text-align: center;
        }
        
        input {
            width: 100%; padding: 15px; margin: 10px 0;
            background: #111; border: 1px solid #333; color: #fff;
            border-radius: 12px; text-align: center; font-size: 1rem;
            font-family: 'Cairo'; outline: none; box-sizing: border-box;
        }
        input:focus { border-color: var(--primary); }

        .btn-full {
            width: 100%; padding: 15px; background: var(--primary);
            color: #000; font-weight: bold; border: none; border-radius: 12px;
            font-size: 1rem; margin-top: 10px; cursor: pointer;
        }
        
        /* Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ÙƒÙ„ */
        .bulk-send-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5253);
            color: #fff; width: 100%; padding: 15px; border: none;
            border-radius: 15px; font-weight: bold; margin-bottom: 20px;
            display: flex; justify-content: center; align-items: center; gap: 10px;
            box-shadow: 0 5px 15px rgba(238, 82, 83, 0.3); cursor: pointer;
        }

    </style>
</head>
<body>

    <div class="header">
        <div class="app-title">BAROUD <span>VAULT</span></div>
        <button class="back-btn" onclick="goHome()"><i class="fa-solid fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="projects-view">
        </div>

    <div id="details-view">
        <div class="glass-card summary-card">
            <div class="summary-label">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</div>
            <div class="summary-val" id="total-debt">$0</div>
        </div>

        <button class="bulk-send-btn" onclick="startBulk()">
            <i class="fa-brands fa-whatsapp"></i> ØªØ­ØµÙŠÙ„ Ø§Ù„ÙƒÙ„ (Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ)
        </button>

        <div class="glass-card" style="padding: 0;" id="clients-list">
            </div>
    </div>

    <button class="fab" onclick="openAddModal()"><i class="fa-solid fa-plus"></i></button>


    <div id="pin-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0">ğŸ”’ Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ù…ÙŠØ©</h3>
            <p style="color:#888; font-size:0.9rem">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</p>
            <input type="password" id="pin-input" placeholder="****" maxlength="8" style="font-size: 1.5rem; letter-spacing: 5px;">
            <button class="btn-full" onclick="verifyPin()">ÙØªØ­ Ø§Ù„Ø®Ø²Ù†Ø©</button>
            <button class="btn-full" style="background:transparent; color:#fff" onclick="closePinModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>


    <div id="add-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="modal-title" style="margin-top:0">Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
            
            <div id="project-inputs">
                <input type="text" id="new-p-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ù…Ø­Ù„)">
                <input type="number" id="new-p-pin" placeholder="ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø³Ø± (Ù…Ø«Ù„Ø§Ù‹: 1234)">
            </div>

            <div id="client-inputs" style="display:none">
                <input type="text" id="new-c-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
                <input type="tel" id="new-c-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (70123456)">
                <input type="number" id="new-c-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº ($)">
            </div>

            <button class="btn-full" onclick="saveData()">Ø­ÙØ¸</button>
            <button class="btn-full" style="background:transparent; color:#888" onclick="closeAddModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="bulk-modal" class="modal-overlay">
        <div class="modal-box" style="background: #fff; color:#000;">
            <div style="font-size:3rem; margin-bottom:10px">ğŸ’¸</div>
            <h3 style="margin:0" id="bulk-c-name">Ø§Ù„Ø§Ø³Ù…</h3>
            <h1 style="margin:5px 0; color: #d32f2f; font-size: 2.5rem" id="bulk-c-amount">$0</h1>
            <p id="bulk-counter" style="color:#666">Ø§Ù„Ø²Ø¨ÙˆÙ† 1 Ù…Ù† 5</p>
            
            <button class="btn-full" style="background:#25D366; color:#fff" onclick="sendNextBulk()">
                <i class="fa-brands fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨
            </button>
            <button class="btn-full" style="background:transparent; color:#555" onclick="closeBulkModal()">Ø¥ÙŠÙ‚Ø§Ù</button>
        </div>
    </div>

<script>
    // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
    // Ø¨Ù†ÙŠØ© Ø§Ù„Ø¯Ø§ØªØ§: { name: "Project", pin: "1234", clients: [] }
    let db = JSON.parse(localStorage.getItem('baroud_secure_v1')) || [];
    
    let activeProjectIdx = -1;
    let pendingProjectIdx = -1; // Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù„ÙŠ Ù†Ø§Ø·Ø± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯

    // --- Ø§Ù„ØªØ´ØºÙŠÙ„ ---
    renderProjects();

    // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ ---
    function renderProjects() {
        const container = document.getElementById('projects-view');
        container.innerHTML = '';

        if(db.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#555; margin-top:50px">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ (+)</p>';
            return;
        }

        db.forEach((proj, idx) => {
            const total = proj.clients.reduce((acc, curr) => acc + curr.amount, 0);
            container.innerHTML += `
                <div class="glass-card project-item" onclick="requestAccess(${idx})">
                    <div style="display:flex; align-items:center">
                        <div class="p-icon"><i class="fa-solid fa-briefcase"></i></div>
                        <div class="p-details" style="margin-left:15px">
                            <h3>${proj.name}</h3>
                            <span>${proj.clients.length} Ø²Ø¨Ø§Ø¦Ù† â€¢ Ù…Ø¬Ù…ÙˆØ¹: $${total}</span>
                        </div>
                    </div>
                    <div class="lock-icon"><i class="fa-solid fa-lock"></i></div>
                </div>
            `;
        });
    }

    function renderClients() {
        const list = document.getElementById('clients-list');
        const totalEl = document.getElementById('total-debt');
        list.innerHTML = '';
        
        const clients = db[activeProjectIdx].clients;
        const total = clients.reduce((acc, curr) => acc + curr.amount, 0);
        totalEl.innerText = '$' + total;

        if(clients.length === 0) {
            list.innerHTML = '<div style="padding:20px; text-align:center; color:#666">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ† Ù…Ø³Ø¬Ù„Ø©</div>';
            return;
        }

        clients.forEach((c, idx) => {
            // Ø£ÙˆÙ„ Ø­Ø±ÙÙŠÙ† Ù„Ù„Ø§Ø³Ù…
            const initials = c.name.substring(0,2).toUpperCase();
            
            list.innerHTML += `
                <div class="client-item">
                    <div style="display:flex; align-items:center">
                        <div class="c-avatar">${initials}</div>
                        <div class="c-info" style="margin-left:15px">
                            <h4>${c.name}</h4>
                            <p>${c.phone}</p>
                        </div>
                    </div>
                    <div style="display:flex; align-items:center">
                        <span style="font-weight:bold; margin-left:10px">$${c.amount}</span>
                        <div class="c-actions">
                            <button class="btn-mini btn-wa" onclick="sendSingle(${idx})"><i class="fa-brands fa-whatsapp"></i></button>
                            <button class="btn-mini btn-del" onclick="deleteClient(${idx})"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    // --- Ø§Ù„Ø­Ù…Ø§ÙŠØ© (Password System) ---
    function requestAccess(idx) {
        pendingProjectIdx = idx;
        document.getElementById('pin-modal').style.display = 'flex';
        document.getElementById('pin-input').value = '';
        document.getElementById('pin-input').focus();
    }

    function verifyPin() {
        const input = document.getElementById('pin-input').value;
        const correctPin = db[pendingProjectIdx].pin;

        if(input === correctPin) {
            // Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ØµØ­
            activeProjectIdx = pendingProjectIdx;
            closePinModal();
            openProjectView();
        } else {
            alert("âŒ Ø±Ù…Ø² Ø®Ø·Ø£! Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹");
        }
    }

    function closePinModal() {
        document.getElementById('pin-modal').style.display = 'none';
        pendingProjectIdx = -1;
    }

    // --- Ø§Ù„ØªÙ†Ù‚Ù„ ---
    function openProjectView() {
        document.getElementById('projects-view').style.display = 'none';
        document.getElementById('details-view').style.display = 'block';
        document.querySelector('.back-btn').style.display = 'block';
        document.querySelector('.app-title').innerHTML = db[activeProjectIdx].name;
        renderClients();
    }

    function goHome() {
        activeProjectIdx = -1;
        document.getElementById('projects-view').style.display = 'block';
        document.getElementById('details-view').style.display = 'none';
        document.querySelector('.back-btn').style.display = 'none';
        document.querySelector('.app-title').innerHTML = 'BAROUD <span>VAULT</span>';
        renderProjects();
    }

    // --- Ø§Ù„Ø¥Ø¶Ø§ÙØ© ---
    function openAddModal() {
        const modal = document.getElementById('add-modal');
        const pInputs = document.getElementById('project-inputs');
        const cInputs = document.getElementById('client-inputs');
        const title = document.getElementById('modal-title');

        // ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.querySelectorAll('input').forEach(i => i.value = '');

        if(activeProjectIdx === -1) {
            title.innerText = "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ğŸ”";
            pInputs.style.display = 'block';
            cInputs.style.display = 'none';
        } else {
            title.innerText = "Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯ ğŸ’¸";
            pInputs.style.display = 'none';
            cInputs.style.display = 'block';
        }
        modal.style.display = 'flex';
    }

    function saveData() {
        if(activeProjectIdx === -1) {
            // Ø­ÙØ¸ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
            const name = document.getElementById('new-p-name').value;
            const pin = document.getElementById('new-p-pin').value;
            if(name && pin) {
                db.push({ name: name, pin: pin, clients: [] });
                updateStorage();
                renderProjects();
                closeAddModal();
            } else { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙˆØ¶Ø¹ Ø§Ø³Ù… ÙˆÙƒÙ„Ù…Ø© Ø³Ø±"); }
        } else {
            // Ø­ÙØ¸ Ø²Ø¨ÙˆÙ†
            const name = document.getElementById('new-c-name').value;
            const phone = document.getElementById('new-c-phone').value;
            const amount = document.getElementById('new-c-amount').value;
            if(name && phone && amount) {
                db[activeProjectIdx].clients.push({
                    name: name,
                    phone: phone,
                    amount: parseFloat(amount)
                });
                updateStorage();
                renderClients();
                closeAddModal();
            }
        }
    }

    function deleteClient(cIdx) {
        if(confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙŠÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            db[activeProjectIdx].clients.splice(cIdx, 1);
            updateStorage();
            renderClients();
        }
    }

    function closeAddModal() {
        document.getElementById('add-modal').style.display = 'none';
    }

    function updateStorage() {
        localStorage.setItem('baroud_secure_v1', JSON.stringify(db));
    }

    // --- Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ---
    function getWaLink(client, projName) {
        let ph = client.phone.toString().replace(/\s/g, '');
        if(!ph.startsWith('961')) ph = '961' + ph;
        const msg = `Ù…Ø±Ø­Ø¨Ø§ ${client.name}ØŒ\nØ­Ø³Ø§Ø¨Ùƒ Ø¨Ù€ *${projName}* Ù‡Ùˆ: $${client.amount}.\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ³Ø¯ÙŠØ¯ ÙˆØ´ÙƒØ±Ø§Ù‹.`;
        return `https://wa.me/${ph}?text=${encodeURIComponent(msg)}`;
    }

    function sendSingle(cIdx) {
        const client = db[activeProjectIdx].clients[cIdx];
        const proj = db[activeProjectIdx].name;
        window.open(getWaLink(client, proj), '_blank');
    }

    // --- Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ ---
    let bulkQ = [];
    let bulkIdx = 0;

    function startBulk() {
        bulkQ = db[activeProjectIdx].clients;
        if(bulkQ.length === 0) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ø¨Ø§Ø¦Ù†!");
        bulkIdx = 0;
        document.getElementById('bulk-modal').style.display = 'flex';
        updateBulkUI();
    }

    function updateBulkUI() {
        if(bulkIdx >= bulkQ.length) {
            closeBulkModal();
            return alert("âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!");
        }
        const c = bulkQ[bulkIdx];
        document.getElementById('bulk-c-name').innerText = c.name;
        document.getElementById('bulk-c-amount').innerText = '$' + c.amount;
        document.getElementById('bulk-counter').innerText = `Ø§Ù„Ø²Ø¨ÙˆÙ† ${bulkIdx + 1} Ù…Ù† ${bulkQ.length}`;
    }

    function sendNextBulk() {
        const c = bulkQ[bulkIdx];
        const proj = db[activeProjectIdx].name;
        window.open(getWaLink(c, proj), '_blank');
        bulkIdx++;
        updateBulkUI();
    }

    function closeBulkModal() {
        document.getElementById('bulk-modal').style.display = 'none';
    }

</script>
</body>
</html>
